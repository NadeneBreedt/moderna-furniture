<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Moderna Office Furniture - Modern Workspace Design Solutions</title>
  <meta name="description" content="Create inspiring workspaces with our curated collection of contemporary office furniture. Premium quality, modern design, and professional installation services.">
  
  <!-- Disable Shopify theme -->
  <meta name="shopify-checkout-api-token" content="null">
  <meta name="shopify-digital-wallet" content="disabled">
  
  <!-- Force favicon refresh with absolute paths -->
  <link rel="icon" type="image/x-icon" href="https://modernaoffice.co.za/favicon/favicon.ico?v=3">
  <link rel="icon" type="image/png" href="https://modernaoffice.co.za/favicon/favicon-96x96.png?v=3" sizes="96x96">
  <link rel="icon" type="image/svg+xml" href="https://modernaoffice.co.za/favicon/favicon.svg?v=3">
  <link rel="apple-touch-icon" sizes="180x180" href="https://modernaoffice.co.za/favicon/apple-touch-icon.png?v=3">
  <link rel="manifest" href="https://modernaoffice.co.za/favicon/site.webmanifest?v=3">
  
  <!-- Preload critical assets -->
  <link rel="preload" href="images/newfront.jpg" as="image">
  <link rel="preload" href="styles/animations.css" as="style">
  <link rel="preload" href="js/header-loader.js" as="script">

  <!-- Preconnect to external domains -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Add fix-sticky.js script -->
  <script src="styles/fix-sticky.js" defer></script>
  
  <!-- Add animations CSS -->
  <link rel="stylesheet" href="styles/animations.css">
  
  <!-- Standardized header loader -->
  <script src="js/header-loader.js" defer></script>

  <style>
    /* Critical CSS */
    :root {
      --primary-color: #292524;
      --accent-color: #78716c;
      --light-gray: #f8f8f8;
      --dark-gray: #444444;
      --border-color: #e7e5e4;
      --text-light: rgba(255, 255, 255, 0.9);
      --text-lighter: rgba(255, 255, 255, 0.7);
      --transition-fast: 0.2s ease;
      --transition-medium: 0.3s ease;
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
    }
    
    * {
      margin: 0; 
      padding: 0; 
      box-sizing: border-box;
    }
    
    body {
      font-family: "Outfit", -apple-system, BlinkMacSystemFont, sans-serif;
      background-color: #FFFFFF;
      color: var(--dark-gray);
      line-height: 1.6;
      opacity: 0;
      animation: fadeIn 0.5s ease-out forwards;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 2rem;
    }

    /* Loading states */
    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #f8f8f8 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
    }

    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    /* Modern header styles */
    header {
      background-color: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border-bottom: 1px solid rgba(231, 229, 228, 0.5);
      position: sticky;
      top: 0;
      z-index: 1000;
      transition: all var(--transition-fast);
    }

    header.scrolled {
      box-shadow: var(--shadow-sm);
    }

    /* Hero section styles */
    .hero-banner {
      position: relative;
      min-height: 80vh;
      display: flex;
      align-items: center;
      background-color: rgba(0, 0, 0, 0.65);
      overflow: hidden;
      width: 100%;
    }

    .hero-content {
      flex: 0 0 50%;
      padding: 6rem 4rem;
      position: relative;
      z-index: 2;
      color: var(--text-light);
      background: linear-gradient(90deg, rgba(0,0,0,0.75) 0%, rgba(0,0,0,0.5) 70%, transparent 100%);
    }

    .hero-title {
      font-family: "Outfit", sans-serif;
      font-size: 4rem;
      font-weight: 600;
      line-height: 1.1;
      margin-bottom: 1.5rem;
      color: var(--text-light);
      text-transform: uppercase;
      letter-spacing: -0.02em;
      opacity: 0;
      transform: translateY(20px);
      animation: slideUp 0.8s ease-out forwards;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .hero-subtitle {
      font-family: "Outfit", sans-serif;
      font-size: 1.5rem;
      font-weight: 400;
      color: var(--text-lighter);
      margin-bottom: 2.5rem;
      opacity: 0;
      transform: translateY(20px);
      animation: slideUp 0.8s ease-out 0.2s forwards;
      max-width: 600px;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    .hero-image {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    .hero-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scale(1.1);
      animation: zoomIn 1.2s ease-out forwards;
    }

    .hero-cta {
      display: flex;
      gap: 1rem;
      opacity: 0;
      transform: translateY(20px);
      animation: slideUp 0.8s ease-out 0.4s forwards;
    }

    .btn {
      font-family: "Outfit", sans-serif;
      display: inline-flex;
      align-items: center;
      padding: 1rem 2.5rem;
      border-radius: 50px;
      font-weight: 500;
      font-size: 1.1rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      transition: all var(--transition-fast);
      text-decoration: none;
      cursor: pointer;
    }

    .btn-primary {
      background-color: var(--text-light);
      color: var(--primary-color);
      box-shadow: var(--shadow-md);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
      background-color: #ffffff;
    }

    .btn-outline {
      border: 2px solid var(--text-lighter);
      color: var(--text-light);
      background-color: transparent;
    }

    .btn-outline:hover {
      background-color: var(--text-light);
      border-color: var(--text-light);
      color: var(--primary-color);
    }

    /* Trust signals */
    .trust-signals {
      padding: 4rem 0;
      background-color: var(--light-gray);
    }

    .trust-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      text-align: center;
    }

    .trust-item {
      padding: 2rem;
    }

    .trust-item svg {
      width: 48px;
      height: 48px;
      margin-bottom: 1rem;
      color: var(--primary-color);
    }

    /* Animations */
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes zoomIn {
      from {
        transform: scale(1.1);
      }
      to {
        transform: scale(1);
      }
    }

    /* Responsive design */
    @media (max-width: 1024px) {
      .hero-title {
        font-size: 3.5rem;
      }
      
      .hero-content {
        flex: 0 0 60%;
        padding: 4rem 3rem;
      }
    }

    @media (max-width: 768px) {
      .hero-banner {
        min-height: 70vh;
      }

      .hero-content {
        flex: 0 0 100%;
        padding: 3rem 2rem;
        background: linear-gradient(180deg, rgba(0,0,0,0.75) 0%, rgba(0,0,0,0.5) 100%);
      }

      .hero-title {
        font-size: 2.5rem;
        letter-spacing: -0.01em;
      }

      .hero-subtitle {
        font-size: 1.25rem;
      }

      .hero-cta {
        flex-direction: column;
      }

      .btn {
        width: 100%;
        justify-content: center;
      }
    }

    /* Modal animations */
    .modal {
      display: none;
      position: fixed;
      z-index: 10000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
      overflow-y: auto; /* Enable scrolling */
    }

    .modal.show {
      display: block;
      opacity: 1;
    }

    .modal-content {
      background-color: #fff;
      margin: 2vh auto;
      padding: 2rem;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      position: relative;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.4s ease-in-out;
      max-height: 96vh; /* Maximum height */
      overflow-y: auto; /* Enable scrolling within modal if needed */
    }

    .modal.show .modal-content {
      opacity: 1;
      transform: translateY(0);
    }

    /* Collections section styles */
    .category-section {
      padding: 4rem 0;
      background-color: var(--light-gray);
    }

    .category-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding: 0 2rem;
    }

    .category-header h2 {
      font-size: 1.75rem;
      color: var(--primary-color);
      font-weight: 600;
      letter-spacing: -0.01em;
    }

    .products-container {
      position: relative;
      padding: 0 2rem;
    }

    .products-grid {
      display: flex;
      gap: 2rem;
      overflow-x: auto;
      scroll-behavior: smooth;
      padding: 1rem 0;
      -ms-overflow-style: none;
      scrollbar-width: none;
    }

    .products-grid::-webkit-scrollbar {
      display: none;
    }

    .product-card {
      flex: 0 0 300px;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: var(--shadow-sm);
      transition: all var(--transition-fast);
      display: flex;
      flex-direction: column;
    }

    .product-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .product-image {
      position: relative;
      padding-top: 100%;
      overflow: hidden;
      background-color: #f8f8f8;
    }

    .product-image img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      padding: 1rem;
      transition: transform 0.3s ease;
    }

    .product-card:hover .product-image img {
      transform: scale(1.05);
    }

    .product-info {
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      flex-grow: 1;
      justify-content: space-between;
    }

    .product-info h3 {
      font-size: 1.1rem;
      color: var(--primary-color);
      margin-bottom: 1rem;
      font-weight: 500;
      line-height: 1.4;
    }

    .scroll-button {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: white;
      border: none;
      box-shadow: var(--shadow-md);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-fast);
      z-index: 2;
    }

    .scroll-button:hover {
      background: var(--light-gray);
      box-shadow: var(--shadow-lg);
    }

    .scroll-left {
      left: 0;
    }

    .scroll-right {
      right: 0;
    }

    .scroll-button svg {
      width: 20px;
      height: 20px;
      color: var(--primary-color);
    }

    .view-products {
      color: var(--accent-color);
      text-decoration: none;
      font-size: 0.95rem;
      font-weight: 500;
      padding: 0.5rem 1rem;
      border-radius: 50px;
      border: 1.5px solid var(--accent-color);
      transition: all var(--transition-fast);
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .view-products:hover {
      background-color: var(--accent-color);
      color: white;
      transform: translateY(-1px);
    }

    .view-products:after {
      content: "→";
      font-family: system-ui;
      transition: transform var(--transition-fast);
    }

    .view-products:hover:after {
      transform: translateX(3px);
    }

    /* Add to Quote button styling */
    .product-action-buttons {
      margin-top: 1rem;
    }

    /* Update Add to Quote button styling to match design */
    .add-to-quote-btn {
        width: 100%;
        padding: 0.75rem 1.5rem;
        background-color: #4a4a4a;  /* Charcoal gray color */
        color: white;
        border: none;
        border-radius: 50px;  /* Fully rounded corners */
        font-size: 1rem;
        font-weight: 500;
        cursor: pointer;
        transition: all var(--transition-fast);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        text-transform: none;  /* Remove text transform */
        letter-spacing: normal;  /* Reset letter spacing */
    }

    .add-to-quote-btn:hover {
        background-color: #5c5c5c;  /* Slightly lighter on hover */
        transform: translateY(-2px);
    }

    .add-to-quote-btn:active {
        transform: translateY(0);
    }

    .add-to-quote-btn.added {
        background-color: #4a4a4a;  /* Keep consistent with the design */
    }

    .add-to-quote-btn svg {
        width: 18px;
        height: 18px;
    }

    /* Toast notification styling */
    .toast-notification {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background-color: #16a34a;
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 500;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.3s ease;
    }

    .toast-notification.show {
      opacity: 1;
      transform: translateY(0);
    }
  </style>
</head>
<body>
  <div id="my-header"></div>

  <main>
    <section class="hero-banner">
      <div class="hero-image">
        <img src="images/newfront.jpg" alt="Modern Office Interior" loading="eager">
      </div>
      <div class="hero-content">
        <h1 class="hero-title">Modern Workspace Design</h1>
        <p class="hero-subtitle">Create inspiring workspaces with our curated collection of contemporary office furniture.</p>
        <div class="hero-cta">
          <a href="/products.html" class="btn btn-primary">Explore Collection</a>
          <a href="/contact" class="btn btn-outline">Get Quote</a>
        </div>
      </div>
    </section>

    <section class="trust-signals">
      <div class="container">
        <div class="trust-grid">
          <div class="trust-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            <h3>Premium Quality</h3>
            <p>Carefully selected materials and expert craftsmanship</p>
          </div>
          <div class="trust-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <h3>Fast Delivery</h3>
            <p>Quick and reliable delivery service nationwide</p>
          </div>
          <div class="trust-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
            </svg>
            <h3>5-Year Warranty</h3>
            <p>Peace of mind with our comprehensive warranty</p>
          </div>
          <div class="trust-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
            </svg>
            <h3>Professional Installation</h3>
            <p>Expert assembly and setup services included</p>
          </div>
        </div>
      </div>
    </section>

    <script>
      // Add scroll effects
      window.addEventListener('scroll', () => {
        const header = document.querySelector('header');
        if (window.scrollY > 0) {
          header.classList.add('scrolled');
        } else {
          header.classList.remove('scrolled');
        }
      });

      // Lazy load images
      document.addEventListener('DOMContentLoaded', () => {
        const images = document.querySelectorAll('img[loading="lazy"]');
        const imageObserver = new IntersectionObserver((entries, observer) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              const img = entry.target;
              img.src = img.dataset.src;
              img.removeAttribute('data-src');
              observer.unobserve(img);
            }
          });
        });

        images.forEach(img => imageObserver.observe(img));
      });
    </script>

    <!-- Collections Section -->
    <section class="category-section">
      <div class="container">
        <!-- Categories will be dynamically loaded here -->
      </div>
    </section>

    <!-- Benefits Section -->
    <section class="benefits">
      <div class="container">
        <div class="benefits-grid">
          <div class="benefit-card">
            <div class="benefit-icon">
              <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22 4 12,14.01 2,6"></polyline>
              </svg>
            </div>
            <h3>Premium Quality</h3>
            <p>Crafted with premium materials and built to last, our furniture combines durability with sophisticated design</p>
          </div>
          
          <div class="benefit-card">
            <div class="benefit-icon">
              <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 6v6l4 2"/>
              </svg>
            </div>
            <h3>Quick Setup</h3>
            <p>Professional installation service available with quick turnaround times to minimize disruption</p>
          </div>
          
          <div class="benefit-card">
            <div class="benefit-icon">
              <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
              </svg>
            </div>
            <h3>Design Consultation</h3>
            <p>Free consultation with our design experts to create your perfect workspace</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Newsletter Section -->
    <section id="contact" style="
      width: 100%;
      background-color: #fff;
    padding: 5rem 0;
    border-top: 1px solid #eee;
  ">
    <div class="container">
      <div style="
        max-width: 800px;
        margin: 0 auto;
        text-align: center;
        background: white;
        padding: 3rem;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      ">
        <div style="
          width: 48px;
          height: 48px;
          background: #f5f5f4;
          border-radius: 50%;
          margin: 0 auto 1.5rem;
          display: flex;
          align-items: center;
          justify-content: center;
        ">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            <path d="M9 12l2 2 4-4"/>
          </svg>
        </div>
        <h2 style="
          font-size: 1.5rem;
          font-weight: 700;
          margin-bottom: 1rem;
          color: #292524;
        ">
          Never miss an update
        </h2>
        <p style="
          color: #78716c;
          font-size: 1rem;
          margin-bottom: 1.5rem;
        ">
          Subscribe to receive news and special offers.
        </p>
        <div style="
          max-width: 1000px;
          margin: 0 auto;
          padding: 0 1rem;
        ">
          <form action="#" method="POST" style="
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            justify-content: center;
            flex-direction: row;
            align-items: center;
          ">
            <div style="
              display: flex;
              gap: 1.5rem;
              width: 100%;
              margin: 0 auto;
            ">
              <input 
                type="text" 
                id="name"
                placeholder="Enter your name"
                required
                style="
                  width: 50%;
                  padding: 0.6rem 0.8rem;
                  font-size: 1rem;
                  border: 1px solid #e7e5e4;
                  border-radius: 8px;
                  background: #fafaf9;
                  height: 38px;
                "
              />
              <input 
                type="email" 
                id="email"
                placeholder="Enter your email"
                required
                style="
                  width: 50%;
                  padding: 0.6rem 0.8rem;
                  font-size: 1rem;
                  border: 1px solid #e7e5e4;
                  border-radius: 8px;
                  background: #fafaf9;
                  height: 38px;
                "
              />
            </div>
            <div style="
              display: flex;
              gap: 1.5rem;
              width: 100%;
              margin: 0 auto;
              margin-bottom: 1.5rem;
            ">
              <input 
                type="tel" 
                id="phone"
                placeholder="Enter your phone number (optional)"
                style="
                  width: 50%;
                  padding: 0.6rem 0.8rem;
                  font-size: 1rem;
                  border: 1px solid #e7e5e4;
                  border-radius: 8px;
                  background: #fafaf9;
                  height: 38px;
                "
              />
              <input 
                type="text" 
                id="company"
                placeholder="Enter your company name (optional)"
                style="
                  width: 50%;
                  padding: 0.6rem 0.8rem;
                  font-size: 1rem;
                  border: 1px solid #e7e5e4;
                  border-radius: 8px;
                  background: #fafaf9;
                  height: 38px;
                "
              />
            </div>
            <div class="form-group">
                <label for="message">Message</label>
                <textarea id="message" placeholder="Your message"></textarea>
            </div>
            <div class="form-group">
                <label for="attachments">Attachments</label>
                <div class="file-upload-container" onclick="document.getElementById('attachments').click()">
                    <input type="file" id="attachments" name="attachments" multiple class="file-input" accept="image/*,.pdf,.doc,.docx">
                    <div class="file-upload-button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        Choose Files
                    </div>
                </div>
                <div id="selected-files" class="selected-files"></div>
            </div>
            <button type="submit" class="submit-btn">Submit</button>
          </form>
        </div>
        </div>
      </div>
    </section>

    <!-- Footer inline -->
    <div id="footer-placeholder">
    <footer style="
      text-align: center;
      padding: 2rem 1rem;
      background-color: #fff;
      box-shadow: 0 -1px 4px rgba(0,0,0,0.05);
          margin-top: 2rem;
      ">
          <div style="max-width: 1200px; margin: 0 auto; display: flex; flex-direction: column; gap: 1.5rem;">
              <!-- Contact Us section with both email and phone -->
              <div style="text-align: center; padding: 1rem; border-bottom: 1px solid #f5f5f4;">
                  <div style="font-size: 0.95rem; font-weight: 600; color: #44403c; margin-bottom: 1rem;">
                      Contact Us
                  </div>
                  <div style="display: flex; flex-direction: row; justify-content: center; gap: 2rem; flex-wrap: wrap;">
                      <a href="mailto:sales@modernaoffice.co.za" style="
                          display: inline-flex;
                          align-items: center;
                          gap: 0.5rem;
                          color: #292524;
                          text-decoration: none;
                          font-size: 1.1rem;
                          font-weight: 600;
                          white-space: nowrap;
                      ">
                          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                              <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                              <polyline points="22,6 12,13 2,6"></polyline>
                          </svg>
                          sales@modernaoffice.co.za
                      </a>
                      <a href="tel:0645367341" style="
                          display: inline-flex;
                          align-items: center;
                          gap: 0.5rem;
                          color: #292524;
                          text-decoration: none;
                          font-size: 1.1rem;
                          font-weight: 600;
                          white-space: nowrap;
                      ">
                          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                              <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                          </svg>
                          <span style="display: inline-block; color: #292524;">064 536 7341</span>
                      </a>
                  </div>
              </div>
              
              <p style="font-size: 0.85rem; color: #78716c; margin: 0;">
                  © 2025 Moderna Office Furniture. All rights reserved.
              </p>
          </div>
    </footer>
  </div>

  <!-- Load Quote Modal -->
  <div id="quote-modal-container"></div>
  <script type="module">
    import { QuoteModal } from './js/modal.js';
    import { createClient } from 'https://esm.sh/@supabase/supabase-js';

    const SUPABASE_URL = 'https://rpncvcioutyrxntqvlnd.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJwbmN2Y2lvdXR5cnhudHF2bG5kIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzkyOTgxNzIsImV4cCI6MjA1NDg3NDE3Mn0.Rm4cDLV4cNubgwDV3SgLt2cC5E3fO4JOuXoK0DrKrzQ';
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Function to fetch products by category with pagination
    async function fetchProductsByCategory(categoryId, offset = 0, limit = 6) {
      console.log(`Fetching products for category ${categoryId}... (offset: ${offset}, limit: ${limit})`);
      try {
        const { data, error } = await supabase
          .from('products_with_categories')
          .select(`
            product_id,
            product_name,
            product_image,
            category_id,
            category_name
          `)
          .eq('category_id', categoryId);

        if (error) {
          console.error('Error fetching products:', error);
          throw error;
        }

        // Custom sorting based on category
        if (data && data.length > 0) {
          if (data[0].category_name === 'Office Chairs') {
            // Chair order
            const chairOrder = ['Gem', 'Dexter', 'Gem', 'Majestic', 'Lugano', 'Kingston'];
            
            data.sort((a, b) => {
              const nameA = a.product_name;
              const nameB = b.product_name;
              
              const orderA = chairOrder.findIndex(name => nameA.startsWith(name));
              const orderB = chairOrder.findIndex(name => nameB.startsWith(name));
              
              if (orderA !== -1 && orderB !== -1) return orderA - orderB;
              if (orderA !== -1) return -1;
              if (orderB !== -1) return 1;
              
              return nameA.localeCompare(nameB);
            });
          } else if (data[0].category_name === 'Desking') {
            // Desking order
            const deskingOrder = [
              'Synergy - Eight Seater',
              'Synergy - Four Seater',
              'Synergy - Six Seater',
              'Synergy - Two Seater',
              'Summit + Hinge Door',
              'Summit + Pedestal',
              'Summit + Roller Door',
              'Summit + Sliding Door'
            ];
            
            data.sort((a, b) => {
              const nameA = a.product_name;
              const nameB = b.product_name;
              
              const orderA = deskingOrder.indexOf(nameA);
              const orderB = deskingOrder.indexOf(nameB);
              
              if (orderA !== -1 && orderB !== -1) return orderA - orderB;
              if (orderA !== -1) return -1;
              if (orderB !== -1) return 1;
              
              return nameA.localeCompare(nameB);
            });
          } else if (data[0].category_name === 'Storage') {
            // Storage order
            const storageOrder = [
              'Cupboards',
              'Desk Height',
              'Mobile',
              'Hinge Door - Side Storage',
              'Rollerdoor Side Storage',
              'Sliding Door Side Storage'
            ];
            
            data.sort((a, b) => {
              const nameA = a.product_name;
              const nameB = b.product_name;
              
              const orderA = storageOrder.indexOf(nameA);
              const orderB = storageOrder.indexOf(nameB);
              
              const partialOrderA = storageOrder.findIndex(name => nameA.startsWith(name));
              const partialOrderB = storageOrder.findIndex(name => nameB.startsWith(name));
              
              if (orderA !== -1 && orderB !== -1) return orderA - orderB;
              if (partialOrderA !== -1 && partialOrderB !== -1) return partialOrderA - partialOrderB;
              if (orderA !== -1 || partialOrderA !== -1) return -1;
              if (orderB !== -1 || partialOrderB !== -1) return 1;
              
              return nameA.localeCompare(nameB);
            });
          } else if (data[0].category_name === 'Executive Desk') {
            // Executive Desk order
            const executiveOrder = [
              'Elevate Executive Desk',
              'Zenith',
              'Aston',
              'Alabama'
            ];
            
            data.sort((a, b) => {
              const nameA = a.product_name;
              const nameB = b.product_name;
              
              const orderA = executiveOrder.indexOf(nameA);
              const orderB = executiveOrder.indexOf(nameB);
              
              const partialOrderA = executiveOrder.findIndex(name => nameA.startsWith(name));
              const partialOrderB = executiveOrder.findIndex(name => nameB.startsWith(name));
              
              if (orderA !== -1 && orderB !== -1) return orderA - orderB;
              if (partialOrderA !== -1 && partialOrderB !== -1) return partialOrderA - partialOrderB;
              if (orderA !== -1 || partialOrderA !== -1) return -1;
              if (orderB !== -1 || partialOrderB !== -1) return 1;
              
              return nameA.localeCompare(nameB);
            });
          } else if (data[0].category_name === 'Couches') {
            // Couch order
            const couchOrder = [
              'The Elmstead',
              'Arcadia',
              'Puzzle Round',
              'The Lennox'
            ];
            
            data.sort((a, b) => {
              const nameA = a.product_name;
              const nameB = b.product_name;
              
              const orderA = couchOrder.indexOf(nameA);
              const orderB = couchOrder.indexOf(nameB);
              
              const partialOrderA = couchOrder.findIndex(name => nameA.startsWith(name));
              const partialOrderB = couchOrder.findIndex(name => nameB.startsWith(name));
              
              if (orderA !== -1 && orderB !== -1) return orderA - orderB;
              if (partialOrderA !== -1 && partialOrderB !== -1) return partialOrderA - partialOrderB;
              if (orderA !== -1 || partialOrderA !== -1) return -1;
              if (orderB !== -1 || partialOrderB !== -1) return 1;
              
              return nameA.localeCompare(nameB);
            });
          } else {
            // For other categories, sort alphabetically
            data.sort((a, b) => a.product_name.localeCompare(b.product_name));
          }
        }

        // Store the full data set in a data attribute on the container
        const container = document.querySelector(`#category-${categoryId} .products-grid`);
        if (container) {
          container.dataset.fullProducts = JSON.stringify(data);
        }

        // Return the paginated subset
        return data.slice(offset, offset + limit) || [];
      } catch (error) {
        console.error('Error in fetchProductsByCategory:', error);
        return [];
      }
    }

    // Function to handle lazy loading of more products
    async function loadMoreProducts(categoryId, container) {
      try {
        // Get the full product set from the container's data attribute
        const fullProducts = JSON.parse(container.dataset.fullProducts || '[]');
        const currentProducts = container.querySelectorAll('.product-card').length;
        
        // Check if we have more products to load
        if (currentProducts >= fullProducts.length) {
          console.log('No more products to load');
          return;
        }
        
        // Get the next batch of products
        const nextProducts = fullProducts.slice(currentProducts, currentProducts + 6);
        
        if (nextProducts && nextProducts.length > 0) {
          const fragment = document.createDocumentFragment();
          
          nextProducts.forEach(product => {
            const productCard = document.createElement('div');
            productCard.className = 'product-card';
            productCard.style.opacity = '0';
            productCard.style.transform = 'translateY(10px)';
            productCard.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
            
            productCard.innerHTML = `
              <div class="product-image">
                <a href="product-detail.html?id=${product.product_id}">
                  <img src="${product.product_image || 'placeholder.jpg'}" 
                       alt="${product.product_name}"
                       loading="lazy">
                </a>
              </div>
              <div class="product-info">
                <h3>${product.product_name}</h3>
                <div class="product-action-buttons">
                  <button class="add-to-quote-btn" 
                          data-product-id="${product.product_id}" 
                          data-product-name="${product.product_name}">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                    </svg>
                    Add to Quote
                  </button>
                </div>
              </div>
            `;

            // Add event listener for quote button
            const quoteButton = productCard.querySelector('.add-to-quote-btn');
            quoteButton.addEventListener('click', function(e) {
                e.preventDefault();
                const productId = this.getAttribute('data-product-id');
                const productName = this.getAttribute('data-product-name');
                
                // Add to quote
                if (typeof window.quoteModal !== 'undefined' && window.quoteModal.addToQuote) {
                    window.quoteModal.addToQuote({
                        id: productId,
                        name: productName,
                        quantity: 1
                    });
                    
                    // Update button state
                    this.classList.add('added');
                    this.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                        Added to Quote
                    `;
                    
                    // Show toast notification
                    showToast(`${productName} added to quote`);
                    
                    // Reset button after 2 seconds
                    setTimeout(() => {
                        this.classList.remove('added');
                        this.innerHTML = `
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                            </svg>
                            Add to Quote
                        `;
                    }, 2000);
                }
            });

            fragment.appendChild(productCard);
          });

          container.appendChild(fragment);

          // Fade in new products with a stagger effect
          container.querySelectorAll('.product-card[style*="opacity: 0"]').forEach((card, index) => {
            setTimeout(() => {
              card.style.opacity = '1';
              card.style.transform = 'translateY(0)';
            }, index * 50);
          });

          // Update scroll buttons after adding new products
          updateScrollButtons();
        }
      } catch (error) {
        console.error('Error in loadMoreProducts:', error);
      }
    }

    // Update scroll event listener to include lazy loading
    function addScrollListeners() {
      document.querySelectorAll('.products-grid').forEach(grid => {
        let isLoading = false; // Flag to prevent multiple simultaneous loads
        
        grid.addEventListener('scroll', async function() {
          if (isLoading) return;
          
          updateScrollButtons();
          
          // Check if we're near the end of scrolling
          const scrollPosition = this.scrollLeft + this.clientWidth;
          const scrollThreshold = this.scrollWidth - 200; // Load more when within 200px of the end
          
          if (scrollPosition > scrollThreshold) {
            isLoading = true;
            const categoryId = this.closest('[id^="category-"]').id.replace('category-', '');
            await loadMoreProducts(categoryId, this);
            isLoading = false;
          }
        });
      });
      
      // Initial update of button visibility
      updateScrollButtons();
      
      // Add resize listener to update buttons on window resize
      window.addEventListener('resize', updateScrollButtons);
    }

    // First load the header - MOVE THIS OUTSIDE OF DOMContentLoaded
    async function initializeApp() {
      try {
        console.log('Initializing app...');
        
        // Load modal
        const modalResponse = await fetch('quote-modal.html');
        const modalData = await modalResponse.text();
        document.getElementById('quote-modal-container').innerHTML = modalData;
        
        // Initialize modal
        window.quoteModal = new QuoteModal();
        
        // Load categories and products
        await loadCategoriesAndProducts();
        
        // Setup quote button
          const heroQuoteBtn = document.getElementById('hero-quote-btn');
          if (heroQuoteBtn) {
            heroQuoteBtn.addEventListener('click', (e) => {
              e.preventDefault();
              const modalOverlay = document.getElementById('quote-modal-overlay');
              if (modalOverlay) {
                modalOverlay.style.display = 'flex';
                if (typeof refreshQuoteTable === 'function') {
                  refreshQuoteTable();
                }
              }
            });
          }
      } catch (err) {
        console.error('Error during initialization:', err);
      }
    }

    // Window global for view more function
    window.showMore = function(categoryId) {
      console.log(`Showing more products for category ${categoryId}`);
      // You can implement a modal or redirect to a category page
    };

    // Clean up our event listeners
    document.addEventListener('DOMContentLoaded', async () => {
      console.log('DOM Content Loaded, initializing...');
      
      try {
        // Test Supabase connection using the view
        console.log('Testing Supabase connection...');
        const { data: products, error: productsError } = await supabase
          .from('products_with_categories')
          .select('*')
          .limit(1);

        if (productsError) {
          console.error('Error accessing products view:', productsError);
          throw productsError;
        }

        console.log('Successfully connected to products view:', products);

        // Now try to fetch a category
        const { data: categories, error: categoriesError } = await supabase
          .from('categories')
          .select('*')
          .limit(1);

        if (categoriesError) {
          console.error('Error accessing categories table:', categoriesError);
          throw categoriesError;
        }

        console.log('Successfully connected to categories table:', categories);

        // If we get here, both tables exist and are accessible
        await initializeApp(); // Call our new initialization function
        
      } catch (err) {
        console.error('Database connection error:', err);
        // Display error message on the page
        const container = document.querySelector('.category-section .container');
        if (container) {
          container.innerHTML += `
            <div style="text-align: center; color: red; margin-top: 2rem;">
              Error connecting to database. Please check the console for details.
            </div>
          `;
        }
      }
    });

    // Function to sort categories in custom order
    function sortCategories(categories) {
      const customOrder = [
        'Office Chairs',
        'Desking',
        'Executive Desk',
        'Storage',
        'Reception Counters',
        'Couches'
      ];
      
      // Create a map for quick lookup of priority
      const priorityMap = new Map(
        customOrder.map((name, index) => [name, index])
      );
      
      return categories.sort((a, b) => {
        // Special case: Always put Ottoman at the end
        if (a.name === 'Ottoman') return 1;
        if (b.name === 'Ottoman') return -1;
        
        const aIndex = priorityMap.get(a.name);
        const bIndex = priorityMap.get(b.name);
        
        // If both categories are in the priority list, sort by their index
        if (aIndex !== undefined && bIndex !== undefined) {
          return aIndex - bIndex;
        }
        
        // If only one is in the priority list, it should come first
        if (aIndex !== undefined) return -1;
        if (bIndex !== undefined) return 1;
        
        // For all other categories, sort alphabetically
        return a.name.localeCompare(b.name);
      });
    }

    // Function to render products with smooth loading
    function renderProducts(products, containerId) {
      console.log('Rendering products for container:', containerId, products);
      const container = document.querySelector(`#${containerId} .products-grid`);
      if (!container) {
        console.error('Container not found:', containerId);
        return;
      }

      if (!products || products.length === 0) {
        console.log('No products to display for:', containerId);
        container.innerHTML = '<p>No products available in this category.</p>';
        return;
      }

      // Create a document fragment to build the content off-DOM
      const fragment = document.createDocumentFragment();
      
      products.forEach(product => {
        const productCard = document.createElement('div');
        productCard.className = 'product-card';
        productCard.style.opacity = '0';
        productCard.style.transform = 'translateY(10px)';
        productCard.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
        
        productCard.innerHTML = `
          <div class="product-image">
            <a href="product-detail.html?id=${product.product_id}">
              <img src="${product.product_image || 'placeholder.jpg'}" 
                   alt="${product.product_name}"
                   loading="lazy">
            </a>
          </div>
          <div class="product-info">
            <h3>${product.product_name}</h3>
            <div class="product-action-buttons">
              <button class="add-to-quote-btn" 
                      data-product-id="${product.product_id}" 
                      data-product-name="${product.product_name}">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                </svg>
                Add to Quote
              </button>
            </div>
          </div>
        `;

        // Add event listener for quote button
        const quoteButton = productCard.querySelector('.add-to-quote-btn');
        quoteButton.addEventListener('click', function(e) {
            e.preventDefault();
            const productId = this.getAttribute('data-product-id');
            const productName = this.getAttribute('data-product-name');
            
            // Add to quote
            if (typeof window.quoteModal !== 'undefined' && window.quoteModal.addToQuote) {
                window.quoteModal.addToQuote({
                    id: productId,
                    name: productName,
                    quantity: 1
                });
                
                // Update button state
                this.classList.add('added');
                this.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg>
                    Added to Quote
                `;
                
                // Show toast notification
                showToast(`${productName} added to quote`);
                
                // Reset button after 2 seconds
                setTimeout(() => {
                    this.classList.remove('added');
                    this.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                        </svg>
                        Add to Quote
                    `;
                }, 2000);
            }
        });

        fragment.appendChild(productCard);
      });

      // Clear the container and append all products at once
      container.innerHTML = '';
      container.appendChild(fragment);

      // Trigger reflow before adding animations
      container.offsetHeight;

      // Fade in products with a stagger effect
      container.querySelectorAll('.product-card').forEach((card, index) => {
        setTimeout(() => {
          card.style.opacity = '1';
          card.style.transform = 'translateY(0)';
        }, index * 50); // 50ms delay between each card
      });
    }

    // Update loadCategoriesAndProducts to load more smoothly
    async function loadCategoriesAndProducts() {
      console.log('Loading categories and products...');
      const container = document.querySelector('.category-section .container');
      
      try {
        const { data: categories, error: categoriesError } = await supabase
          .from('categories')
          .select('*');
        
        if (categoriesError) {
          console.error('Error loading categories:', categoriesError);
          return;
        }
        
        if (!categories || categories.length === 0) {
          container.innerHTML = '<div style="text-align: center; margin-top: 2rem;"><p>No categories available.</p></div>';
          return;
        }
        
        // Sort categories in custom order
        const sortedCategories = sortCategories(categories);
        
        // First, render all category containers without products
        container.innerHTML = sortedCategories.map(category => renderCategorySection(category)).join('');
        
        // Then load products for each category sequentially
        for (const category of sortedCategories) {
          const products = await fetchProductsByCategory(category.id);
          renderProducts(products, `category-${category.id}`);
          await new Promise(resolve => setTimeout(resolve, 100)); // Small delay between categories
        }

        // Add scroll listeners after all categories and products are loaded
        addScrollListeners();
      } catch (err) {
        console.error('Error in loadCategoriesAndProducts:', err);
        container.innerHTML = `
          <div style="text-align: center; margin-top: 2rem;">
            <p>Error loading categories. Please try refreshing the page.</p>
          </div>
        `;
      }
    }

    // Function to render category section
    function renderCategorySection(category) {
      return `
        <div class="category-section" id="category-${category.id}">
          <div class="category-header">
            <h2>${category.name}</h2>
            <a href="products.html?category=${category.id}" class="view-products">View Full Collection</a>
          </div>
          <div class="products-container">
            <button class="scroll-button scroll-left" onclick="scrollProducts('category-${category.id}', 'left')">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M15 19l-7-7 7-7"/>
              </svg>
            </button>
            <div class="products-grid">
              <!-- Products will be loaded here -->
            </div>
            <button class="scroll-button scroll-right" onclick="scrollProducts('category-${category.id}', 'right')">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 5l7 7-7 7"/>
              </svg>
            </button>
          </div>
        </div>
      `;
    }

    // Initialize global functions
    window.scrollProducts = function(categoryId, direction) {
      const container = document.querySelector(`#${categoryId} .products-grid`);
      if (!container) return;

      const scrollAmount = 600; // Adjust this value to control scroll distance
      const currentScroll = container.scrollLeft;
      
      container.scrollTo({
        left: direction === 'left' ? currentScroll - scrollAmount : currentScroll + scrollAmount,
        behavior: 'smooth'
      });

      // Update button visibility after scrolling
      updateScrollButtons();
    };

    // Update visibility of scroll buttons based on scroll position
    function updateScrollButtons() {
      document.querySelectorAll('.products-container').forEach(container => {
        const grid = container.querySelector('.products-grid');
        const leftButton = container.querySelector('.scroll-left');
        const rightButton = container.querySelector('.scroll-right');
        
        if (grid && leftButton && rightButton) {
          // Show/hide left button based on scroll position
          leftButton.style.opacity = grid.scrollLeft > 0 ? '1' : '0';
          leftButton.style.visibility = grid.scrollLeft > 0 ? 'visible' : 'hidden';
          
          // Show/hide right button based on whether there's more content to scroll
          const maxScroll = grid.scrollWidth - grid.clientWidth;
          rightButton.style.opacity = grid.scrollLeft < maxScroll ? '1' : '0';
          rightButton.style.visibility = grid.scrollLeft < maxScroll ? 'visible' : 'hidden';
        }
      });
    }

    const form = document.querySelector('form');
    const messageDiv = document.getElementById('subscription-message');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const submitButton = form.querySelector('button[type="submit"]');
      submitButton.disabled = true;
      submitButton.textContent = 'Subscribing...';

      try {
        const formData = {
          name: document.getElementById('name').value,
          email: document.getElementById('email').value,
          phone: document.getElementById('phone').value || null,
          company: document.getElementById('company').value || null,
        };

        const { data, error } = await supabase
          .from('newsletter_subscribers')
          .insert([formData]);

        if (error) {
          throw error;
        }

        // Show success message
        messageDiv.style.display = 'block';
        messageDiv.style.backgroundColor = '#f0fdf4';
        messageDiv.style.color = '#166534';
        messageDiv.style.border = '1px solid #bbf7d0';
        messageDiv.textContent = 'Thank you for subscribing to our newsletter!';
        
        // Reset form
        form.reset();

      } catch (error) {
        console.error('Detailed error:', error);
        // Show error message
        messageDiv.style.display = 'block';
        messageDiv.style.backgroundColor = '#fef2f2';
        messageDiv.style.color = '#b91c1c';
        messageDiv.style.border = '1px solid #fecaca';
        messageDiv.textContent = 'Sorry, there was an error. Please try again later.';
      } finally {
        // Re-enable submit button
        submitButton.disabled = false;
        submitButton.textContent = 'Subscribe';
      }
    });

    // Load footer
    fetch('footer.html')
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to load footer');
            }
            return response.text();
        })
        .then(data => {
            document.getElementById('footer-placeholder').innerHTML = data;
        })
        .catch(err => {
            console.error('Error loading footer:', err);
            // We already have a fallback footer in the HTML
    });

    // Add event listener for the hero quote button
    document.getElementById('hero-quote-btn').addEventListener('click', function(e) {
        e.preventDefault();
        window.location.href = 'contact.html';
    });

    // Function to show toast notification
    function showToast(message, duration = 3000) {
        const toast = document.getElementById('toast-notification');
        toast.textContent = message;
        toast.classList.add('show');
        
        setTimeout(() => {
            toast.classList.remove('show');
        }, duration);
    }
  </script>
  <!-- WhatsApp Button -->
  <a href="https://wa.me/27645367341" class="whatsapp-button" target="_blank" rel="noopener noreferrer">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
      <path d="M12.031 6.172c-3.181 0-5.767 2.586-5.768 5.766-.001 1.298.38 2.27 1.019 3.287l-.582 2.128 2.182-.573c.978.58 1.911.928 3.145.929 3.178 0 5.767-2.587 5.768-5.766.001-3.187-2.575-5.771-5.764-5.771zm3.392 8.244c-.144.405-.837.774-1.17.824-.299.045-.677.063-1.092-.069-.252-.08-.575-.187-.988-.365-1.739-.751-2.874-2.502-2.961-2.617-.087-.116-.708-.94-.708-1.793s.448-1.273.607-1.446c.159-.173.346-.217.462-.217l.332.006c.106.005.249-.04.39.298.144.347.491 1.2.534 1.287.043.087.072.072.188.014.304-.058.116-.087.188-.173.289l-.26.304c-.087.086-.177.18-.076.354.101.174.449.741.964 1.201.662.591 1.221.774 1.394.86s.274.072.376-.043c.101-.116.433-.506.549-.68.116-.173.231-.145.39-.087s1.011.477 1.184.564.289.13.332.202c.045.072.045.419-.1.824zm-3.423-14.416c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm.029 18.88c-1.161 0-2.305-.292-3.318-.844l-3.677.964.984-3.595c-.607-1.052-.927-2.246-.926-3.468.001-3.825 3.113-6.937 6.937-6.937 1.856.001 3.598.723 4.907 2.034 1.31 1.311 2.031 3.054 2.03 4.908-.001 3.825-3.113 6.938-6.937 6.938z"/>
    </svg>
  </a>

  <style>
    .whatsapp-button {
      position: fixed;
      bottom: 24px;
      left: 24px;
      background-color: #ffffff;
      color: white;
      border-radius: 50%;
      width: 55px;
      height: 55px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      transition: all 0.3s ease;
      z-index: 1000;
      transform: translate3d(0, 0, 0);
      backface-visibility: hidden;
      perspective: 1000px;
    }

    .whatsapp-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      animation: none;
    }

    .whatsapp-button svg {
      width: 38px;
      height: 38px;
      color: #25D366;
    }

    @media (max-width: 768px) {
      .whatsapp-button {
        width: 45px;
        height: 45px;
        bottom: 16px;
        left: 16px;
      }
      
      .whatsapp-button svg {
        width: 30px;
        height: 30px;
      }
    }
  </style>

  <!-- Contact Pop-up Modal -->
  <div id="contact-modal" class="modal">
      <div class="modal-content">
          <span class="close-button">&times;</span>
          <h2>Looking for something specific? Email us</h2>
          <form id="contact-form">
              <div class="form-group">
                  <label for="name">Name</label>
                  <input type="text" id="name" placeholder="Your name">
              </div>
              <div class="form-group">
                  <label for="email">Email <span class="required">*</span></label>
                  <input type="email" id="email" placeholder="Your email" required>
              </div>
              <div class="form-group">
                  <label for="cell_number">Contact Number</label>
                  <input type="tel" id="cell_number" placeholder="Your contact number">
              </div>
              <div class="form-group">
                  <label for="message">Message</label>
                  <textarea id="message" placeholder="Your message"></textarea>
              </div>
              <div class="form-group">
                  <label for="attachments">Attachments</label>
                  <div class="file-upload-container" onclick="document.getElementById('attachments').click()">
                      <input type="file" id="attachments" name="attachments" multiple class="file-input" accept="image/*,.pdf,.doc,.docx">
                      <div class="file-upload-button">
                          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                              <polyline points="17 8 12 3 7 8"/>
                              <line x1="12" y1="3" x2="12" y2="15"/>
                          </svg>
                          Choose Files
                      </div>
                  </div>
                  <div id="selected-files" class="selected-files"></div>
              </div>
              <button type="submit" class="submit-btn">Submit</button>
          </form>
      </div>
  </div>

  <style>
      .modal {
          display: none;
          position: fixed;
          z-index: 10000;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.5);
          opacity: 0;
          transition: opacity 0.3s ease-in-out;
          overflow-y: auto; /* Enable scrolling */
      }

      .modal.show {
          display: block;
          opacity: 1;
      }

      .modal-content {
          background-color: #fff;
          margin: 2vh auto;
          padding: 2rem;
          border-radius: 12px;
          width: 90%;
          max-width: 500px;
          position: relative;
          opacity: 0;
          transform: translateY(20px);
          transition: all 0.4s ease-in-out;
          max-height: 96vh; /* Maximum height */
          overflow-y: auto; /* Enable scrolling within modal if needed */
      }

      .modal.show .modal-content {
          opacity: 1;
          transform: translateY(0);
      }

      /* Form group spacing */
      .form-group {
          margin-bottom: 1.25rem;
      }

      /* Input and textarea sizing */
      .form-group input {
          height: 42px;
      }

      .form-group textarea {
          height: 100px;
          min-height: 100px;
          max-height: 200px;
      }

      /* Responsive adjustments */
      @media (max-height: 700px) {
          .modal-content {
              margin: 1vh auto;
              padding: 1.5rem;
          }

          .form-group {
              margin-bottom: 1rem;
          }

          .form-group textarea {
              height: 80px;
          }
      }

      @media (max-width: 480px) {
          .modal-content {
              width: 95%;
              padding: 1.5rem;
          }

          .modal h2 {
              font-size: 1.25rem;
              margin-bottom: 1rem;
          }
      }

      /* Smooth scrollbar for the modal */
      .modal-content {
          scrollbar-width: thin;
          scrollbar-color: #78716c transparent;
      }

      .modal-content::-webkit-scrollbar {
          width: 6px;
      }

      .modal-content::-webkit-scrollbar-track {
          background: transparent;
      }

      .modal-content::-webkit-scrollbar-thumb {
          background-color: #78716c;
          border-radius: 3px;
      }

      /* File upload container adjustments */
      .file-upload-container {
          margin-top: 0.5rem;
      }

      /* Selected files container */
      .selected-files {
          margin-top: 0.5rem;
          max-height: 100px;
          overflow-y: auto;
      }

      /* Submit button positioning */
      .submit-btn {
          margin-top: 1rem;
      }

      .close-button {
          position: absolute;
          right: 1.5rem;
          top: 1.5rem;
          font-size: 1.5rem;
          cursor: pointer;
          color: #78716c;
      }

      .close-button:hover {
          color: #292524;
      }

      .modal h2 {
          color: #292524;
          font-size: 1.5rem;
          font-weight: 600;
          margin-bottom: 1.5rem;
      }

      .form-group label {
          display: block;
          color: #57534e;
          font-size: 0.9rem;
          margin-bottom: 0.5rem;
      }

      .form-group input,
      .form-group textarea {
          width: 100%;
          padding: 0.75rem;
          border: 1px solid #e7e5e4;
          border-radius: 8px;
          font-size: 1rem;
          transition: border-color 0.2s;
      }

      .form-group textarea {
          height: 100px;
          resize: vertical;
      }

      .form-group input:focus,
      .form-group textarea:focus {
          outline: none;
          border-color: #78716c;
      }

      .required {
          color: #ef4444;
      }

      .submit-btn {
          width: 100%;
          padding: 0.875rem;
          background: #292524;
          color: white;
          border: none;
          border-radius: 8px;
          font-size: 1rem;
          font-weight: 500;
          cursor: pointer;
          transition: background-color 0.2s;
      }

      .submit-btn:hover {
          background: #44403c;
      }

      .error-message {
          color: #ef4444;
          font-size: 0.875rem;
          margin-top: 0.25rem;
          display: none;
      }

      .error-message.show {
          display: block;
      }
  </style>

  <script type="module">
      import { createClient } from 'https://esm.sh/@supabase/supabase-js';

      const CONTACT_FORM_SUPABASE_URL = 'https://rpncvcioutyrxntqvlnd.supabase.co';
      const CONTACT_FORM_SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJwbmN2Y2lvdXR5cnhudHF2bG5kIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzkyOTgxNzIsImV4cCI6MjA1NDg3NDE3Mn0.Rm4cDLV4cNubgwDV3SgLt2cC5E3fO4JOuXoK0DrKrzQ';
      const contactFormSupabase = createClient(CONTACT_FORM_SUPABASE_URL, CONTACT_FORM_SUPABASE_KEY);

      // Get modal elements
      const contactModal = document.getElementById('contact-modal');
      const modalCloseButton = document.querySelector('.close-button');
      const contactForm = document.getElementById('contact-form');
      const fileInput = document.getElementById('attachments');
      const selectedFilesContainer = document.getElementById('selected-files');

      // Show modal after a short delay when page loads
      setTimeout(() => {
          // Check if user has already seen the popup
          if (!localStorage.getItem('popupShown')) {
              contactModal.style.display = 'block';
              // Trigger reflow
              contactModal.offsetHeight;
              contactModal.classList.add('show');
              // Add show class to modal content after modal is visible
              setTimeout(() => {
                  document.querySelector('.modal-content').style.opacity = '1';
                  document.querySelector('.modal-content').style.transform = 'translateY(0)';
              }, 50);
              
              // Set flag in localStorage to indicate popup has been shown
              localStorage.setItem('popupShown', 'true');
          }
      }, 2000);

      // Close modal when clicking close button or outside
      modalCloseButton.addEventListener('click', () => {
          document.querySelector('.modal-content').style.opacity = '0';
          document.querySelector('.modal-content').style.transform = 'translateY(20px)';
          contactModal.classList.remove('show');
          setTimeout(() => {
              contactModal.style.display = 'none';
          }, 400); // Match the transition duration
      });

      window.addEventListener('click', (e) => {
          if (e.target === contactModal) {
              document.querySelector('.modal-content').style.opacity = '0';
              document.querySelector('.modal-content').style.transform = 'translateY(20px)';
              contactModal.classList.remove('show');
              setTimeout(() => {
                  contactModal.style.display = 'none';
              }, 400); // Match the transition duration
          }
      });

      // Handle file selection
      fileInput.addEventListener('change', () => {
          selectedFilesContainer.innerHTML = '';
          Array.from(fileInput.files).forEach(file => {
              const fileElement = document.createElement('div');
              fileElement.className = 'selected-file';
              fileElement.innerHTML = `
                  <span>${file.name}</span>
                  <div class="upload-progress">
                      <div class="upload-progress-bar" style="width: 0%"></div>
                  </div>
              `;
              selectedFilesContainer.appendChild(fileElement);
          });
      });

      // Handle form submission
      contactForm.addEventListener('submit', async (e) => {
          e.preventDefault();

          const submitButton = contactForm.querySelector('.submit-btn');
          submitButton.disabled = true;
          submitButton.textContent = 'Submitting...';

          try {
              // Get form data
              const name = document.querySelector('#contact-form #name').value.trim();
              const email = document.querySelector('#contact-form #email').value.trim();
              const cellNumber = document.querySelector('#contact-form #cell_number').value.trim();
              const message = document.querySelector('#contact-form #message').value.trim();

              // Validate required fields
              if (!email) {
                  throw new Error('Email is required');
              }

              const files = fileInput.files;
              const uploadedUrls = [];

              // Upload files if any are selected
              if (files.length > 0) {
                  for (let i = 0; i < files.length; i++) {
                      const file = files[i];
                      const fileExt = file.name.split('.').pop();
                      const timestamp = new Date().getTime();
                      const fileName = `${timestamp}_${file.name}`;
                      const filePath = `attachments/${fileName}`;

                      // Get the progress bar for this file
                      const progressBar = selectedFilesContainer.children[i]?.querySelector('.upload-progress-bar');

                      try {
                          // Upload file to Supabase Storage
                          const { data: uploadData, error: uploadError } = await contactFormSupabase.storage
                              .from('quote-attachments')
                              .upload(filePath, file, {
                                  cacheControl: '3600',
                                  upsert: false
                              });

                          if (uploadError) {
                              console.error('Upload error:', uploadError);
                              throw uploadError;
                          }

                          // Update progress bar to show completion
                          if (progressBar) {
                              progressBar.style.width = '100%';
                          }

                          // Get public URL for the uploaded file
                          const { data: { publicUrl } } = contactFormSupabase.storage
                              .from('quote-attachments')
                              .getPublicUrl(filePath);

                          uploadedUrls.push(publicUrl);
                      } catch (uploadError) {
                          console.error('Error uploading file:', uploadError);
                          throw new Error(`Error uploading file ${file.name}`);
                      }
                  }
              }

              // Prepare form data with attachments
              const formData = {
                  name: name,
                  email: email,
                  cell_number: cellNumber,
                  message: message,
                  created_at: new Date().toISOString(),
                  attachment_url: uploadedUrls[0] || null,
                  attachment_urls: uploadedUrls.length > 0 ? uploadedUrls : null
              };

              console.log('Submitting form data:', formData);

              // Insert data into customers table
              const { data, error } = await contactFormSupabase
                  .from('customers')
                  .insert([formData]);

              if (error) {
                  console.error('Database error:', error);
                  throw error;
              }

              // Show success message and close modal
              alert('Thank you for your message! We will get back to you soon.');
              contactModal.classList.remove('show');
              setTimeout(() => {
                  contactModal.style.display = 'none';
              }, 300);
              
              // Reset form and clear file list
              contactForm.reset();
              selectedFilesContainer.innerHTML = '';

          } catch (error) {
              console.error('Error:', error);
              alert(error.message || 'There was an error submitting your message. Please try again.');
          } finally {
              submitButton.disabled = false;
              submitButton.textContent = 'Submit';
          }
      });
  </script>

  <!-- Add toast notification container -->
  <div id="toast-notification" class="toast-notification"></div>
</body>

<!-- Scroll animation script -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Add scroll-fade-in class to elements we want to animate on scroll
    const elementsToAnimate = [
      '.category-container',
      '.benefit-card',
      '#contact .container > div',
      '.section-title',
      '.section-subtitle'
    ];
    
    // Apply the scroll-fade-in class to all matching elements
    elementsToAnimate.forEach(selector => {
      document.querySelectorAll(selector).forEach(element => {
        element.classList.add('scroll-fade-in');
      });
    });
    
    // Function to check if an element is in viewport
    function isInViewport(element) {
      const rect = element.getBoundingClientRect();
      return (
        rect.top <= (window.innerHeight || document.documentElement.clientHeight) * 0.85 &&
        rect.bottom >= 0
      );
    }
    
    // Function to handle scroll events and trigger animations
    function handleScroll() {
      document.querySelectorAll('.scroll-fade-in').forEach(element => {
        if (isInViewport(element) && !element.classList.contains('visible')) {
          element.classList.add('visible');
        }
      });
    }
    
    // Initial check on page load
    handleScroll();
    
    // Listen for scroll events
    window.addEventListener('scroll', handleScroll);
  });
</script>
</html>