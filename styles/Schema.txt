-- Categories Table
CREATE TABLE public.categories (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  name text NOT NULL,
  description text NULL,
  created_at timestamp with time zone NULL DEFAULT now(),
  image_url text NULL,
  CONSTRAINT categories_pkey PRIMARY KEY (id)
) TABLESPACE pg_default;

-- Customers Table
CREATE TABLE public.customers (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  email text NOT NULL,
  name text NOT NULL,
  company_name text NULL,
  cell_number text NULL,
  location text NULL,
  created_at timestamp with time zone NULL DEFAULT now(),
  CONSTRAINT customers_pkey PRIMARY KEY (id)
) TABLESPACE pg_default;

-- Newsletter Subscribers Table
CREATE TABLE public.newsletter_subscribers (
  id bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  name text NOT NULL,
  email text NOT NULL,
  phone text NULL,
  company text NULL,
  subscribed_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT newsletter_subscribers_pkey PRIMARY KEY (id),
  CONSTRAINT newsletter_subscribers_email_key UNIQUE (email)
) TABLESPACE pg_default;

-- Option Values Table
CREATE TABLE public.option_values (
  id bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  option_id bigint NULL,
  value text NOT NULL,
  price_adjustment numeric(10,2) NULL DEFAULT 0,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT option_values_pkey PRIMARY KEY (id),
  CONSTRAINT option_values_option_id_fkey FOREIGN KEY (option_id) REFERENCES product_options(id)
) TABLESPACE pg_default;

-- Product Categories Table
CREATE TABLE public.product_categories (
  product_id bigint NOT NULL,
  category_id bigint NOT NULL,
  CONSTRAINT product_categories_pkey PRIMARY KEY (product_id, category_id),
  CONSTRAINT product_categories_category_id_fkey FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE CASCADE,
  CONSTRAINT product_categories_product_id_fkey FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE
) TABLESPACE pg_default;
CREATE INDEX IF NOT EXISTS idx_product_categories_product_id ON public.product_categories USING btree (product_id) TABLESPACE pg_default;
CREATE INDEX IF NOT EXISTS idx_product_categories_category_id ON public.product_categories USING btree (category_id) TABLESPACE pg_default;

-- Product Options Table
CREATE TABLE public.product_options (
  id bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  product_id bigint NULL,
  option_name text NOT NULL,
  option_type text NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT product_options_pkey PRIMARY KEY (id),
  CONSTRAINT product_options_product_id_fkey FOREIGN KEY (product_id) REFERENCES products(id)
) TABLESPACE pg_default;

-- Products Table
CREATE TABLE public.products (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  name text NOT NULL,
  description text NULL,
  created_at timestamp with time zone NULL DEFAULT now(),
  image_url text NULL,
  gallery_images text[] NULL,
  CONSTRAINT products_pkey PRIMARY KEY (id)
) TABLESPACE pg_default;

-- Products with Categories View
CREATE VIEW public.products_with_categories AS 
SELECT p.id AS product_id,
       p.name AS product_name,
       p.image_url AS product_image,
       c.id AS category_id,
       c.name AS category_name
FROM products p
LEFT JOIN product_categories pc ON p.id = pc.product_id
LEFT JOIN categories c ON pc.category_id = c.id;

-- Quote Items Table
CREATE TABLE public.quote_items (
  id bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  quote_request_id bigint NULL,
  product_id bigint NULL,
  product_name text NOT NULL,
  quantity integer NOT NULL DEFAULT 1,
  specifications text NULL,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT quote_items_pkey PRIMARY KEY (id),
  CONSTRAINT quote_items_product_id_fkey FOREIGN KEY (product_id) REFERENCES products(id),
  CONSTRAINT quote_items_quote_request_id_fkey FOREIGN KEY (quote_request_id) REFERENCES quote_requests(id) ON DELETE CASCADE
) TABLESPACE pg_default;

-- Quote Requests Table
CREATE TABLE public.quote_requests (
  id bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  customer_name text NOT NULL,
  customer_email text NOT NULL,
  customer_phone text NOT NULL,
  status text NOT NULL DEFAULT 'new'::text,
  attachment_url text NULL,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT quote_requests_pkey PRIMARY KEY (id)
) TABLESPACE pg_default;